pkgname=Pacman.NET
pkgver=0
pkgrel=1
pkgdesc='Arch Linux package cache and repository'
arch=('x86_64')
url="https://github.com/ricardoalcaraz/Pacman.NET"
source=("${pkgname}"::"git+https://github.com/ricardoalcaraz/Pacman.NET.git" '20-pacnet.conf' '20-sudo' '20-pacman.conf')
makedepends=('dotnet-sdk')
depends=('dotnet-runtime' 'aspnet-runtime' 'reflector' 'openssh' 'git' 'rsync')
b2sums=('SKIP' 'SKIP' 'SKIP' 'SKIP')
backup=('etc/pacman.d/mirrorlist')

build() {
  pwd
  ls -al 
  ls -al $srcdir/$pkgname
  cd $srcdir/$pkgname/$pkgname
  dotnet publish -o $srcdir/publish/$pkgname
}

check() {
  cd $srcdir/$pkgname
  #dotnet test
}

package() {
  install -Dm644 $srcdir/20-pacnet.conf $pkgdir/usr/lib/sysusers.d/$pkgname.conf
  install -Dm644 $srcdir/20-sudo $pkgdir/etc/sudoers.d/$pkgname
  install -Dm644 $srcdir/20-pacman.conf $pkgdir/etc/pacman.conf.d/$pkgname.conf
  install -Dm644 $srcdir/$pkgname/$pkgname/deploy/$pkgname.service $pkgdir/usr/lib/systemd/system/$pkgname.service

  mkdir -p $pkgdir/srv/http
  mv $srcdir/publish/$pkgname $pkgdir/srv/http
  chown -R 1420:http $pkgdir/srv/http/$pkgname
  chmod 775 $pkgdir/srv/http/$pkgname
  chmod 660 $pkgdir/srv/http/$pkgname/*.json
}